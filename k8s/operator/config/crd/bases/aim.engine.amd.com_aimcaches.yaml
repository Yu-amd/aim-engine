apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: aimcaches.aim.engine.amd.com
  annotations:
    controller-gen.kubebuilder.io/version: v0.14.0
spec:
  group: aim.engine.amd.com
  names:
    kind: AIMCache
    listKind: AIMCacheList
    plural: aimcaches
    singular: aimcache
    shortNames:
      - cache
      - aimc
  scope: Namespaced
  versions:
    - name: v1alpha1
      served: true
      storage: true
      subresources:
        status: {}
      schema:
        openAPIV3Schema:
          description: AIMCache is the Schema for the aimcaches API
          type: object
          properties:
            apiVersion:
              description: APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
              type: string
            kind:
              description: Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
              type: string
            metadata:
              type: object
            spec:
              description: AIMCacheSpec defines the desired state of AIMCache
              type: object
              required:
                - storage
              properties:
                storage:
                  description: Storage configuration
                  type: object
                  required:
                    - size
                  properties:
                    storageClass:
                      description: Storage class name
                      type: string
                      default: "local-path"
                    size:
                      description: Cache size
                      type: string
                      pattern: '^[0-9]+[KMGTPEZYkmgtpezy]i?$'
                      example: "100Gi"
                    accessMode:
                      description: Access mode
                      type: string
                      enum:
                        - ReadWriteOnce
                        - ReadOnlyMany
                        - ReadWriteMany
                      default: ReadWriteOnce
                    mountPath:
                      description: Mount path in containers
                      type: string
                      default: "/workspace/model-cache"
                models:
                  description: Model cache configuration
                  type: array
                  items:
                    type: object
                    required:
                      - id
                    properties:
                      id:
                        description: Model ID
                        type: string
                        example: "Qwen/Qwen3-32B"
                      priority:
                        description: Cache priority
                        type: string
                        enum:
                          - low
                          - medium
                          - high
                          - critical
                        default: medium
                      retention:
                        description: Retention period
                        type: string
                        pattern: '^[0-9]+[dhms]$'
                        example: "30d"
                      maxSize:
                        description: Maximum size for this model
                        type: string
                        pattern: '^[0-9]+[KMGTPEZYkmgtpezy]i?$'
                        example: "50Gi"
                      preload:
                        description: Preload model on cache creation
                        type: boolean
                        default: false
                cleanup:
                  description: Cleanup configuration
                  type: object
                  properties:
                    enabled:
                      description: Enable automatic cleanup
                      type: boolean
                      default: true
                    schedule:
                      description: Cleanup schedule (cron format)
                      type: string
                      default: "0 2 * * *"
                    maxAge:
                      description: Maximum age for cached models
                      type: string
                      pattern: '^[0-9]+[dhms]$'
                      example: "30d"
                    minFreeSpace:
                      description: Minimum free space to maintain
                      type: string
                      pattern: '^[0-9]+[KMGTPEZYkmgtpezy]i?$'
                      example: "10Gi"
                    policy:
                      description: Cleanup policy
                      type: string
                      enum:
                        - lru
                        - lfu
                        - fifo
                        - size
                      default: lru
                sharing:
                  description: Cache sharing configuration
                  type: object
                  properties:
                    enabled:
                      description: Enable cache sharing
                      type: boolean
                      default: true
                    accessMode:
                      description: Sharing access mode
                      type: string
                      enum:
                        - ReadOnly
                        - ReadWrite
                      default: ReadOnly
                    endpoints:
                      description: Endpoints that can access this cache
                      type: array
                      items:
                        type: object
                        properties:
                          name:
                            description: Endpoint name
                            type: string
                          namespace:
                            description: Endpoint namespace
                            type: string
                security:
                  description: Security configuration
                  type: object
                  properties:
                    readOnly:
                      description: Make cache read-only
                      type: boolean
                      default: false
                    encryption:
                      description: Enable encryption
                      type: boolean
                      default: false
                    encryptionKey:
                      description: Encryption key secret
                      type: object
                      properties:
                        name:
                          description: Secret name
                          type: string
                        key:
                          description: Secret key
                          type: string
            status:
              description: AIMCacheStatus defines the observed state of AIMCache
              type: object
              properties:
                conditions:
                  description: Conditions represent the latest available observations of an object's state
                  type: array
                  items:
                    description: Condition contains details for one aspect of the current state of this API Resource
                    type: object
                    required:
                      - lastTransitionTime
                      - message
                      - observedGeneration
                      - reason
                      - status
                      - type
                    properties:
                      lastTransitionTime:
                        description: lastTransitionTime is the last time the condition transitioned from one status to another. This should be when the underlying condition changed. If that is not known, then using the time when the API field changed is acceptable.
                        type: string
                        format: date-time
                      message:
                        description: message is a human readable message indicating details about the transition. This may be an empty string.
                        type: string
                        maxLength: 32768
                      observedGeneration:
                        description: observedGeneration represents the .metadata.generation that the condition was set based upon. For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date with respect to the current state of the instance.
                        type: integer
                        format: int64
                        minimum: 0
                      reason:
                        description: reason contains a programmatic identifier indicating the reason for the condition's last transition. Producers of specific condition types may define expected values and meanings for this field, and whether the values are considered a guaranteed API. The value should be a CamelCase string. This field may not be empty.
                        type: string
                        maxLength: 1024
                        pattern: '^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$'
                      status:
                        description: status of the condition, one of True, False, Unknown.
                        type: string
                        enum:
                          - "True"
                          - "False"
                          - Unknown
                      type:
                        description: type of condition in CamelCase or in foo.example.com/CamelCase.
                        type: string
                        maxLength: 316
                        pattern: '^([a-z0-9]([a-z0-9-]*[a-z0-9])?(\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$'
                observedGeneration:
                  description: ObservedGeneration is the last observed generation.
                  type: integer
                  format: int64
                phase:
                  description: Current phase of the cache
                  type: string
                  enum:
                    - Pending
                    - Creating
                    - Ready
                    - Failed
                    - Cleaning
                capacity:
                  description: Cache capacity information
                  type: object
                  properties:
                    total:
                      description: Total capacity
                      type: string
                    used:
                      description: Used capacity
                      type: string
                    available:
                      description: Available capacity
                      type: string
                    utilization:
                      description: Utilization percentage
                      type: number
                      minimum: 0
                      maximum: 100
                models:
                  description: Cached models information
                  type: array
                  items:
                    type: object
                    properties:
                      id:
                        description: Model ID
                        type: string
                      size:
                        description: Model size
                        type: string
                      lastAccessed:
                        description: Last access time
                        type: string
                        format: date-time
                      accessCount:
                        description: Access count
                        type: integer
                        minimum: 0
                      status:
                        description: Model status
                        type: string
                        enum:
                          - Downloading
                          - Ready
                          - Corrupted
                          - Expired
                endpoints:
                  description: Endpoints using this cache
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        description: Endpoint name
                        type: string
                      namespace:
                        description: Endpoint namespace
                        type: string
                      accessMode:
                        description: Access mode
                        type: string
                lastCleanup:
                  description: Last cleanup information
                  type: object
                  properties:
                    time:
                      description: Cleanup time
                      type: string
                      format: date-time
                    modelsRemoved:
                      description: Number of models removed
                      type: integer
                      minimum: 0
                    spaceFreed:
                      description: Space freed
                      type: string
      additionalPrinterColumns:
        - name: Size
          type: string
          jsonPath: .spec.storage.size
        - name: Used
          type: string
          jsonPath: .status.capacity.used
        - name: Utilization
          type: string
          jsonPath: .status.capacity.utilization
        - name: Models
          type: integer
          jsonPath: .status.models
        - name: Phase
          type: string
          jsonPath: .status.phase
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp 